generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  USER
}

model User {
  id String @id @default(uuid())
  email String @unique
  password String
  fullName String?
  role Role @default(USER)
  createdAt DateTime  @default(now())
  updatedAt DateTime @updatedAt

  projects Project[]
  subscription Subscription?
}

model Project {
  id String @id @default(uuid())
  userId String
  name String
  description String?
  apiKey String @unique @default(uuid())
  webhookUrl String? 
  minConfidenceThreshold Float @default(80.0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  user User @relation(fields: [userId], references: [id])
  authLogs ApiLog[]
}

model ApiLog {
  id String @id @default(uuid())
  projectId String
  endpoint String
  status Int
  createdAt DateTime @default(now())

  project Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
  
  @@index([projectId, createdAt])
}

model Plan {
  id String @id @default(uuid())
  name String @unique 
  monthlyPrice Float
  apiCallLimit Int 
  maxProjects Int
  
  subscriptions Subscription[]
}

enum SubscriptionStatus {
  ACTIVE
  CANCELED
  PAST_DUE
  UNPAID
}

model Subscription {
  id String @id @default(uuid())
  userId String @unique
  planId String
  status SubscriptionStatus @default(ACTIVE)
  currentPeriodStart DateTime
  currentPeriodEnd DateTime
  
  user User @relation(fields: [userId], references: [id])
  plan Plan @relation(fields: [planId], references: [id])
}

model Otp {
  id String @id @default(uuid())
  email String @unique
  code String
  expiresAt DateTime
  createdAt DateTime @default(now())
}